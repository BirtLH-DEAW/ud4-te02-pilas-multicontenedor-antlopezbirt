# La declaración de versión ya no se usa, está obsoleta
#version: '3' 

# Servicios a integrar
services: 
 
  # MySQL, contendrá las BD del proyecto PHP y Wordpress
  mysql:
    build:
      context: db/
      # Se pueden cambiar los valores mediante estos argumentos
      args:
        WP_URL: 'http://localhost:8080/wordpress'
        WP_DB_NAME: 'wordpress'
        WP_DB_PREFIX: 'wp_'
        WP_DB_USER: 'anton'
        WP_DB_PASS: 'anton'
        WP_ADMIN_USER: 'anton'
        WP_ADMIN_PASS: 'anton'
        WP_ADMIN_EMAIL: 'antlopez@birt.eus'
    environment:
      MYSQL_ALLOW_EMPTY_PASSWORD: 'true'
      MYSQL_DATABASE: 'dwes'
      MYSQL_USER: 'dwes'
      MYSQL_PASSWORD: 'dwes'
    container_name: 'db'
    networks:
      - miapp

  # Apache, contendrá el proyecto PHP y también el proyecto Wordpress
  apache:
    build:
      context: apache/
      # Se pueden cambiar los valores de wp-config.php mediante estos argumentos
      args:
        WP_DB_HOST: 'db'
        WP_DB_NAME: 'wordpress'
        WP_DB_USER: 'anton'
        WP_DB_PASS: 'anton'
        WP_DB_PREFIX: 'wp_'
    ports:
      - 8080:80
    volumes:
      - proyecto:/usr/local/apache2/htdocs
    networks:
      - miapp

  php:
    build: php/
    # No es necesario exponer el puerto de PHP al host, ya que quien accede es el contendor de Apache
    # Podría incluso ser un problema de seguridad si no fuera una instalación local
    # ports:
    #   - 9000:9000
    volumes:
      - proyecto:/var/www/html
    networks:
      - miapp

  # PHPMyAdmin, para gestionar visualmente las bases de datos
  phpmyadmin:
    image: phpmyadmin
    ports:
      - 8081:80
    environment:
      MYSQL_ROOT_PASSWORD: 
      PMA_HOST: db
    networks:
      - miapp

volumes: 
  proyecto:
networks:
  miapp:
    driver: bridge